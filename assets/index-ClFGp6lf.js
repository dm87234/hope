import{a as de,g as ie}from"./category-BkggJSSP.js";import{g as ve,a as pe,e as me,b as fe,d as _e}from"./records-5bRpDPOe.js";import{f as oe}from"./moneyFormat-VgRRH0h_.js";import{_ as le,r as i,j as ye,d as g,o as r,c as f,a as w,b as l,t as M,F as O,k as q,n as Z,l as T,e as b,m as ae,p as ge,g as he,q as ee,s as W,f as Y,w as s,v as ke,E as $,x as Ce,y as De}from"./index-CDQqNoF5.js";import"./request-BYauAGfa.js";const Me="/eric-project/assets/cost-CzR4K-fl.png",$e="/eric-project/assets/income-BpWlCHRw.png",ue=v=>(ge("data-v-1635452d"),v=v(),he(),v),we={class:"calendarContainer"},be={class:"toolbar"},Ie={class:"date"},Ve={class:"calendarBox"},xe=["onClick"],Se=["onClick"],Ye={key:0,class:"records"},Le={key:0,class:"income"},Re=ue(()=>w("span",null,"收入: ",-1)),Be={key:1,class:"cost"},Te=ue(()=>w("span",null,"支出: ",-1)),Ae=["onClick"],Pe={__name:"myCalendar",emits:["pickedDate"],setup(v,{expose:E,emit:L}){let e=i();const I=i(["一","二","三","四","五","六","日"]),C=i(0),A=i([]),P=i(0),N=i([]),U=i(0),d=i(0),n=i(0),V=i(0),_=i([]),t=(u,D)=>new Date(u,D-1,1).getDay(),S=()=>{const u=new Date,D=u.getFullYear(),B=u.getMonth()+1,c=u.getDate();return{year:D,month:B,date:c}},k=i([31,29,31,30,31,30,31,31,30,31,30,31]),h=i([31,28,31,30,31,30,31,31,30,31,30,31]),x=u=>u%4===0&&u%100!==0||u%400===0,p=()=>{const{year:u,month:D,date:B}=S();d.value===u&&n.value===D?V.value=B:V.value="",C.value=t(d.value,n.value)===0?6:t(d.value,n.value)-1,U.value=x(d.value)?k.value[n.value-1]:h.value[n.value-1],_.value=[];const c=ee(()=>o.value.filter(a=>a.statusCode==="1").map(a=>a.costYear+a.costMonth+a.costDate+"$"+a.money)),m=ee(()=>o.value.filter(a=>a.statusCode==="0").map(a=>a.costYear+a.costMonth+a.costDate+"$"+a.money));let Q=d.value.toString(),ce=n.value<10?"0"+n.value.toString():n.value.toString();for(let a=0;a<U.value;a++){let y=a+1<10?"0"+(a+1).toString():(a+1).toString(),K=Q+ce+y;_.value.push({date:K,isholiday:!1,income:!1,cost:!1,incomeTotal:0,costTotal:0})}_.value.forEach(a=>{for(let y=0;y<J.length;y++)a.date===J[y].date&&(a.isholiday=!0);for(let y=0;y<c.value.length;y++)if(a.date===c.value[y].substring(0,8)){a.income=!0;let K=+c.value[y].substring(9);a.incomeTotal+=K}for(let y=0;y<m.value.length;y++)if(a.date===m.value[y].substring(0,8)){a.cost=!0;let K=+m.value[y].substring(9);a.costTotal+=K}});let X=0;n.value===1?X=x(d.value-1)?k.value[k.value.length-1]:h.value[h.value.length-1]:X=x(d.value)?k.value[n.value-2]:h.value[n.value-2],P.value=42-(C.value+U.value);const se=[],ne=[];for(let a=X-C.value+1;a<=X;a++)se.push(a);for(let a=1;a<=P.value;a++)ne.push(a);A.value=se,N.value=ne},j=()=>{const{year:u,month:D,date:B}=S();d.value=u,n.value=D,V.value=B,p()},G=u=>{e.value=u,n.value===1?(n.value=12,d.value--):n.value--,u&&(z.value=`${d.value}-${n.value}-${u}`,R("pickedDate")),F()},H=u=>{e.value=u,n.value===12?(n.value=1,d.value++):n.value++,u&&(z.value=`${d.value}-${n.value}-${u}`,R("pickedDate")),F()};let z=i("");const R=L,te=u=>{e.value=u,z.value=`${d.value}-${n.value}-${u}`,R("pickedDate")},o=i([]),F=async()=>{const{data:{data:u}}=await ve();o.value=u,p()},J=[];return j(),ye(()=>{z.value=`${d.value}-${n.value}-${V.value}`}),F(),E({openDate:z,getMonthlyRecords:F}),(u,D)=>{const B=g("font-awesome-icon");return r(),f("div",we,[w("div",be,[w("div",{class:"changeMonthBtn",onClick:D[0]||(D[0]=c=>G())},[l(B,{icon:["fas","chevron-left"]})]),w("div",Ie,M(d.value)+"年"+M(n.value)+"月",1),w("div",{class:"changeMonthBtn",onClick:D[1]||(D[1]=c=>H())},[l(B,{icon:["fas","chevron-right"]})])]),w("div",Ve,[(r(!0),f(O,null,q(I.value,(c,m)=>(r(),f("div",{key:m,class:"weekday"},M(c),1))),128)),(r(!0),f(O,null,q(A.value,(c,m)=>(r(),f("div",{onClick:Q=>G(c),key:m,class:Z(["date notThisMonth",{holiday:c.isholiday===!0,pickDate:m+1===T(e)}])},M(c),11,xe))),128)),(r(!0),f(O,null,q(_.value,(c,m)=>(r(),f("div",{onClick:Q=>te(m+1),key:m,class:Z(["date",{active:m+1===V.value,holiday:c.isholiday===!0,pickDate:m+1===T(e)}])},[b(M(m+1)+" ",1),c.income||c.cost?(r(),f("div",Ye,[c.income?(r(),f("div",Le,[Re,w("span",null,M(T(oe)(c.incomeTotal)),1)])):ae("",!0),c.cost?(r(),f("div",Be,[Te,w("span",null,M(T(oe)(c.costTotal)),1)])):ae("",!0)])):ae("",!0)],10,Se))),128)),(r(!0),f(O,null,q(N.value,(c,m)=>(r(),f("div",{onClick:Q=>H(c),key:m,class:Z(["date notThisMonth",{holiday:c.isholiday===!0,pickDate:m+1===T(e)}])},M(c),11,Ae))),128))])])}}},Ne=le(Pe,[["__scopeId","data-v-1635452d"]]),re=v=>W(v).format("YYYY-MM-DD"),Ue=v=>W(v).format("YYYY"),ze=v=>W(v).format("MM"),Ee=v=>W(v).format("DD"),je=W().format("YYYY-MM-DD"),Fe=["id"],Oe={class:"dialog-footer"},qe={__name:"editRecord",props:{cateList:Array},emits:["success"],setup(v,{expose:E,emit:L}){const e=i({id:"",date:"",status:"0",categoryId:"",money:0,memo:""}),I=i(!1),C=v,A=ee(()=>C.cateList.filter(_=>_.statusCode==="0")),P=ee(()=>C.cateList.filter(_=>_.statusCode==="1")),N=L,U=/^[1-9]\d*$/,d=async _=>{if(e.value.date=re(e.value.date),e.value.costYear=Ue(e.value.date),e.value.costMonth=ze(e.value.date),e.value.costDate=Ee(e.value.date),e.value.date==="Invalid Date")return $.error("請輸入日期");if(e.value.categoryId==="")return $.error("請選擇類別");if(e.value.money===0)return $.error("請輸入金額");if(!U.test(e.value.money))return $.error("金額只能是正整數");if(e.value.id){const{data:t}=await me({id:e.value.id,categoryId:e.value.categoryId,money:e.value.money,memo:e.value.memo});if(t.status!==0)return $.error("更新紀錄失敗");$.success("更新紀錄成功"),I.value=!1}else{const{data:t}=await pe(e.value);if(t.status!==0)return $.error("新增失敗");$.success("新增成功"),_==="save"&&(I.value=!1)}e.value.id="",e.value.categoryId="",e.value.money=0,e.value.memo="",N("success")},n=(_,t)=>{Object.keys(t).length===0?e.value.date=_:e.value={id:t.id,date:t.completeDate,status:t.statusCode,categoryId:t.categoryId,money:t.money,memo:t.memo},I.value=!0},V=()=>{e.value.id="",e.value.categoryId="",e.value.money=0,e.value.memo="",I.value=!1};return E({open:n}),(_,t)=>{const S=g("el-icon"),k=g("el-date-picker"),h=g("el-form-item"),x=g("el-option"),p=g("el-select"),j=g("el-col"),G=g("el-row"),H=g("el-input"),z=g("el-form"),R=g("el-button"),te=g("el-dialog");return r(),Y(te,{onClose:V,modelValue:I.value,"onUpdate:modelValue":t[10]||(t[10]=o=>I.value=o),width:"370","show-close":!1,style:{"background-color":"#fff8f1","border-radius":"8px"}},{header:s(({close:o,titleId:F,titleClass:J})=>[w("h4",{id:F,class:Z(J)},M(e.value.id?"編輯":"新增"),11,Fe),l(S,{onClick:o,color:"#F56C6C",size:"24",style:{cursor:"pointer"}},{default:s(()=>[l(T(ke))]),_:2},1032,["onClick"])]),footer:s(()=>[w("div",Oe,[e.value.id?(r(),Y(R,{key:1,onClick:t[8]||(t[8]=o=>d("save")),type:"primary",style:{width:"100px"}},{default:s(()=>[b("更新")]),_:1})):(r(),Y(R,{key:0,onClick:t[7]||(t[7]=o=>d("save")),type:"primary",style:{width:"100px"}},{default:s(()=>[b("儲存")]),_:1})),e.value.id?(r(),Y(R,{key:3,onClick:V,type:"danger",style:{width:"100px"}},{default:s(()=>[b("取消")]),_:1})):(r(),Y(R,{key:2,onClick:t[9]||(t[9]=o=>d("oneMore")),type:"primary",style:{width:"100px"}},{default:s(()=>[b("再記一筆")]),_:1}))])]),default:s(()=>[l(z,null,{default:s(()=>[l(h,null,{default:s(()=>[l(k,{readonly:e.value.id,modelValue:e.value.date,"onUpdate:modelValue":t[0]||(t[0]=o=>e.value.date=o),type:"date",style:{width:"100%"}},null,8,["readonly","modelValue"])]),_:1}),l(G,{gutter:20},{default:s(()=>[l(j,{span:7},{default:s(()=>[l(h,null,{default:s(()=>[l(p,{onChange:t[1]||(t[1]=o=>e.value.categoryId=""),"fit-input-width":"",modelValue:e.value.status,"onUpdate:modelValue":t[2]||(t[2]=o=>e.value.status=o)},{default:s(()=>[l(x,{label:"支出",value:"0"}),l(x,{label:"收入",value:"1"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(j,{span:17},{default:s(()=>[e.value.status==="0"?(r(),Y(h,{key:0},{default:s(()=>[l(p,{modelValue:e.value.categoryId,"onUpdate:modelValue":t[3]||(t[3]=o=>e.value.categoryId=o),placeholder:"選擇類別"},{default:s(()=>[(r(!0),f(O,null,q(A.value,o=>(r(),Y(x,{key:o.id,label:o.categoryName,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):(r(),Y(h,{key:1},{default:s(()=>[l(p,{modelValue:e.value.categoryId,"onUpdate:modelValue":t[4]||(t[4]=o=>e.value.categoryId=o),placeholder:"選擇類別"},{default:s(()=>[(r(!0),f(O,null,q(P.value,o=>(r(),Y(x,{key:o.id,label:o.categoryName,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}))]),_:1})]),_:1}),l(h,null,{default:s(()=>[l(H,{modelValue:e.value.money,"onUpdate:modelValue":t[5]||(t[5]=o=>e.value.money=o),maxlength:"9",autocomplete:"off",placeholder:"請輸入金額",formatter:o=>`$ ${o}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:o=>o.replace(/\$\s?|(,*)/g,""),"validate-event":""},null,8,["modelValue","formatter","parser"])]),_:1}),l(h,null,{default:s(()=>[l(H,{modelValue:e.value.memo,"onUpdate:modelValue":t[6]||(t[6]=o=>e.value.memo=o),maxlength:"30",rows:5,placeholder:"請輸入備註","show-word-limit":"",resize:"none",type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}}},He=le(qe,[["__scopeId","data-v-444fcced"]]),Ke=Ce("budget-category",()=>{const v=i([]);return{cateList:v,setCateList:L=>{v.value=L}}},{persist:!0}),We={class:"homeContainer m50"},Ge={key:0,src:Me,class:"statusIcon"},Je={key:1,src:$e,class:"statusIcon"},Qe={__name:"index",setup(v){const E=Ke(),L=i([]),e=i(null),I=je,C=i(""),A=i([]),P=i(null),N=t=>{P.value.open(e.value.openDate,t)},U=t=>{De.confirm("確定要刪除此類別嗎?",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning"}).then(async()=>{const{data:S}=await _e(t);S.status!==0&&$.error("刪除失敗"),$.success("刪除成功"),d()}).catch(()=>{})},d=async()=>{C.value=C.value||I;const{data:t}=await fe(C.value);if(t.status!==0)return $.error("服務異常");L.value=t.data},n=async()=>{const{data:t}=await ie();if(t.status!==0)return $.error("服務異常");E.setCateList(t.data),A.value=t.data},V=()=>{d(),e.value.getMonthlyRecords()},_=()=>{C.value=e.value.openDate,d(C.value)};return d(),n(),(t,S)=>{const k=g("el-table-column"),h=g("el-button"),x=g("el-table");return r(),f("div",We,[l(Ne,{ref_key:"calendar",ref:e,onPickedDate:_},null,512),l(de,{onClick:S[0]||(S[0]=p=>N({}))},{default:s(()=>[b("新增一筆")]),_:1}),l(x,{data:L.value,stripe:"",style:{width:"100%"}},{default:s(()=>[l(k,{prop:"completeDate",label:"日期",width:"100"},{default:s(({row:p})=>[b(M(T(re)(p.completeDate)),1)]),_:1}),l(k,{prop:"categoryId",label:"類別"},{default:s(({row:p})=>[p.statusCode==="0"?(r(),f("img",Ge)):(r(),f("img",Je)),b(" "+M(p.categoryName),1)]),_:1}),l(k,{prop:"money",label:"金額"},{default:s(({row:p})=>[b(M(T(oe)(p.money)),1)]),_:1}),l(k,{prop:"memo",label:"備註"}),l(k,{label:"操作",width:"75"},{default:s(({row:p})=>[l(h,{size:"small",type:"success",onClick:j=>N(p)},{default:s(()=>[b("編輯")]),_:2},1032,["onClick"])]),_:1}),l(k,{width:"75"},{default:s(({row:p})=>[l(h,{onClick:j=>U(p.id),size:"small",type:"danger"},{default:s(()=>[b("刪除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),l(He,{ref_key:"dialog",ref:P,cateList:A.value,onSuccess:V},null,8,["cateList"])])}}},ot=le(Qe,[["__scopeId","data-v-96a04908"]]);export{ot as default};
