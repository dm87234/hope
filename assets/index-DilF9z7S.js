import{i as S}from"./request-BYauAGfa.js";import{i as A,f as I}from"./moneyFormat-VgRRH0h_.js";import{_ as z,r as s,d as p,o as v,c as E,a as o,z as k,f as w,e as m,E as T,j as K,b as g,w as l,n as Q,t as _,l as $,F as R,k as W,p as X,g as Z}from"./index-CDQqNoF5.js";import{s as ee}from"./selectMonth-CtdmMVjI.js";const te=(a,e)=>S.get("/budget/getMonthlyBudget",{params:{budgetYear:a,budgetMonth:e}}),ae=({totalBudget:a,budgetYear:e,budgetMonth:u})=>S.post("/budget/addMonthlyBudget",{totalBudget:a,budgetYear:e,budgetMonth:u}),oe=({totalBudget:a,id:e})=>S.put("/budget/updateMonthlyBudget",{totalBudget:a,id:e}),se=(a,e)=>S.get("/budget/getCateBudget",{params:{budgetYear:a,budgetMonth:e}}),ne=({categoryId:a,budget:e,budgetYear:u,budgetMonth:r})=>S.post("/budget/addCateBudget",{categoryId:a,budget:e,budgetYear:u,budgetMonth:r}),le=({budget:a,id:e})=>S.put("/budget/updateCateBudget",{budget:a,id:e}),ue={class:"budgetCateItem"},re={class:"leftIcon"},de={class:"right"},ce={class:"top"},ie={key:0},ge={class:"bottom"},pe={__name:"budgetCateItem",props:{cateItem:Object,year:String,month:String},emits:["success"],setup(a,{emit:e}){const u=s(!1),r=a,c=s(),d=e,h=()=>{c.value=r.cateItem.budget,u.value=!0},b=async()=>{if(r.cateItem.id){if(!A(c.value))return T.error("預算只能是正整數或0");const{data:n}=await le({id:r.cateItem.id,budget:c.value});if(n.status!==0)return T.error("服務異常");d("success")}else{if(!A(c.value))return T.error("預算只能是正整數或0");const{data:n}=await ne({categoryId:r.cateItem.cateId,budget:c.value,budgetYear:r.year,budgetMonth:r.month});if(n.status!==0)return T.error("服務異常");d("success")}u.value=!1};return(n,M)=>{const B=p("el-input"),f=p("font-awesome-icon");return v(),E("div",ue,[o("div",re,[k(n.$slots,"icon",{},void 0,!0)]),o("div",de,[o("div",ce,[o("div",null,[k(n.$slots,"cateName",{},void 0,!0)]),o("div",null,[u.value?(v(),w(B,{key:1,modelValue:c.value,"onUpdate:modelValue":M[0]||(M[0]=i=>c.value=i),maxlength:"9",style:{width:"120px","font-size":"16px"},formatter:i=>`$ ${i}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:i=>i.replace(/\$\s?|(,*)/g,"")},null,8,["modelValue","formatter","parser"])):(v(),E("span",ie,[k(n.$slots,"cateBudget",{},void 0,!0)])),u.value?(v(),w(f,{key:3,icon:["fas","circle-check"],onClick:b})):(v(),w(f,{key:2,icon:["fas","pencil"],onClick:h}))])]),o("div",null,[k(n.$slots,"progress",{},void 0,!0)]),o("div",ge,[o("div",null,[m("剩餘: "),k(n.$slots,"remains",{},void 0,!0)]),o("div",null,[m("支出: "),k(n.$slots,"cost",{},void 0,!0)])])])])}}},ve=z(pe,[["__scopeId","data-v-36f82436"]]),_e=a=>(X("data-v-e6f7dbe0"),a=a(),Z(),a),me={class:"budgetContainer m50"},fe={class:"monthlyBudgetBox"},he={class:"left"},be={class:"percentage-value"},Be={class:"right"},ye={class:"notice"},Ce=_e(()=>o("div",null,"各類別預算",-1)),Ie={class:"budgetCateContainer"},ke={__name:"index",setup(a){const e=s(0),u=s(!1),r=s(!0),c=s(null),d=s(null),h=s([]),b=s([]),n=s(),M=s(),B=s(0),f=s(0),i=s(0),O=/^[1-9]\d*$/,D=()=>{r.value=!1,u.value=!0,c.value.focus()},L=async()=>{if(!O.test(e.value))return T.error("金額只能是正整數");h.value.length===0?await ae({totalBudget:e.value,budgetYear:d.value.currentYear,budgetMonth:d.value.exposeMonth}):(e.value||(e.value=0),await oe({totalBudget:e.value,id:h.value[0].id})),r.value=!0,u.value=!1,N(),V()},N=async()=>{n.value=d.value.currentYear.toString(),M.value=d.value.exposeMonth.toString();const{data:{data:x}}=await te(d.value.currentYear,d.value.exposeMonth);x.length>0&&(h.value=x,e.value=h.value[0].totalBudget)},V=async()=>{const{data:x}=await se(d.value.currentYear,d.value.exposeMonth);b.value=x.data,B.value=b.value.reduce((y,C)=>y+C.totalSum,0),f.value=b.value.reduce((y,C)=>y+C.budget,0),i.value=parseInt((e.value-B.value)/e.value*100),i.value<0&&(i.value=0)},j=()=>{V()},F=()=>{N(),V()};return K(()=>{N(),V()}),(x,y)=>{const C=p("el-progress"),U=p("el-input"),P=p("font-awesome-icon"),q=p("el-form-item"),G=p("el-form"),Y=p("el-descriptions-item"),H=p("el-descriptions"),J=p("el-card");return v(),E("div",me,[g(ee,{ref_key:"month",ref:d,onChangeMonth:F},null,512),g(J,{shadow:"never"},{default:l(()=>[o("div",fe,[o("div",he,[g(C,{type:"circle",percentage:i.value,color:"#2ED573","stroke-width":"12"},{default:l(({percentage:t})=>[o("span",be,_(t)+"%",1)]),_:1},8,["percentage"])]),o("div",Be,[g(G,null,{default:l(()=>[g(q,{label:"本月總預算"},{default:l(()=>[g(U,{ref_key:"inp",ref:c,modelValue:e.value,"onUpdate:modelValue":y[0]||(y[0]=t=>e.value=t),maxlength:"9",readonly:r.value,size:"large",style:{width:"200px","font-size":"20px"},formatter:t=>`$ ${t}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:t=>t.replace(/\$\s?|(,*)/g,"")},null,8,["modelValue","readonly","formatter","parser"]),u.value?(v(),w(P,{key:1,icon:["fas","circle-check"],onClick:L})):(v(),w(P,{key:0,icon:["fas","pencil"],onClick:D}))]),_:1})]),_:1}),g(H,{column:"1"},{default:l(()=>[g(Y,{label:"本月總支出"},{default:l(()=>[m(_($(I)(B.value)),1)]),_:1}),g(Y,{label:"剩餘"},{default:l(()=>[m(_($(I)(e.value-B.value)),1)]),_:1})]),_:1})])])]),_:1}),o("div",ye,[Ce,o("div",{class:Q({danger:e.value-f.value<0})}," 待分配預算: "+_(e.value-f.value<0?"各類別預算總和已超過本月總預算!!":$(I)(e.value-f.value)),3)]),o("div",Ie,[(v(!0),E(R,null,W(b.value,t=>(v(),w(ve,{key:t.id,cateItem:t,year:n.value,month:M.value,onSuccess:j},{icon:l(()=>[m(_(t.categoryPic),1)]),cateBudget:l(()=>[m(_(t.budget?$(I)(t.budget):"---"),1)]),cateName:l(()=>[m(_(t.categoryName),1)]),remains:l(()=>[m(_(t.budget?$(I)(t.budget-t.totalSum):"---"),1)]),cost:l(()=>[m(_(t.totalSum?$(I)(t.totalSum):0),1)]),progress:l(()=>[g(C,{"text-inside":!0,"stroke-width":20,percentage:isNaN(parseInt((t.budget-t.totalSum)/t.budget*100))||parseInt((t.budget-t.totalSum)/t.budget*100)<0?0:parseInt((t.budget-t.totalSum)/t.budget*100)},null,8,["percentage"])]),_:2},1032,["cateItem","year","month"]))),128))])])}}},xe=z(ke,[["__scopeId","data-v-e6f7dbe0"]]);export{xe as default};
