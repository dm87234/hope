import{i as S}from"./request-CVdgLUBt.js";import{i as A,f as C}from"./moneyFormat-VgRRH0h_.js";import{_ as z,r as l,d as g,o as p,c as T,a as o,z as k,f as w,e as m,E as N,j as J,b as i,w as n,n as K,t as _,l as $,F as Q,k as R,p as W,g as X}from"./index-FHfZcE39.js";import{s as Z}from"./selectMonth-TOvjGOps.js";const ee=(a,e)=>S.get("/budget/getMonthlyBudget",{params:{budgetYear:a,budgetMonth:e}}),te=({totalBudget:a,budgetYear:e,budgetMonth:u})=>S.post("/budget/addMonthlyBudget",{totalBudget:a,budgetYear:e,budgetMonth:u}),ae=({totalBudget:a,id:e})=>S.put("/budget/updateMonthlyBudget",{totalBudget:a,id:e}),oe=(a,e)=>S.get("/budget/getCateBudget",{params:{budgetYear:a,budgetMonth:e}}),se=({categoryId:a,budget:e,budgetYear:u,budgetMonth:r})=>S.post("/budget/addCateBudget",{categoryId:a,budget:e,budgetYear:u,budgetMonth:r}),ne=({budget:a,id:e})=>S.put("/budget/updateCateBudget",{budget:a,id:e}),le={class:"budgetCateItem"},ue={class:"leftIcon"},re={class:"right"},de={class:"top"},ce={key:0},ie={class:"bottom"},ge={__name:"budgetCateItem",props:{cateItem:Object,year:String,month:String},emits:["success"],setup(a,{emit:e}){const u=l(!1),r=a,c=l(),d=e,b=()=>{c.value=r.cateItem.budget,u.value=!0},y=async()=>{if(r.cateItem.id){if(!A(c.value))return N.error("預算只能是正整數或0");const{data:s}=await ne({id:r.cateItem.id,budget:c.value});if(s.status!==0)return N.error("服務異常");d("success")}else{if(!A(c.value))return N.error("預算只能是正整數或0");const{data:s}=await se({categoryId:r.cateItem.cateId,budget:c.value,budgetYear:r.year,budgetMonth:r.month});if(s.status!==0)return N.error("服務異常");d("success")}u.value=!1};return(s,M)=>{const v=g("el-input"),h=g("font-awesome-icon");return p(),T("div",le,[o("div",ue,[k(s.$slots,"icon",{},void 0,!0)]),o("div",re,[o("div",de,[o("div",null,[k(s.$slots,"cateName",{},void 0,!0)]),o("div",null,[u.value?(p(),w(v,{key:1,modelValue:c.value,"onUpdate:modelValue":M[0]||(M[0]=B=>c.value=B),maxlength:"9",style:{width:"120px","font-size":"16px"},formatter:B=>`$ ${B}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:B=>B.replace(/\$\s?|(,*)/g,"")},null,8,["modelValue","formatter","parser"])):(p(),T("span",ce,[k(s.$slots,"cateBudget",{},void 0,!0)])),u.value?(p(),w(h,{key:3,icon:["fas","circle-check"],onClick:y})):(p(),w(h,{key:2,icon:["fas","pencil"],onClick:b}))])]),o("div",null,[k(s.$slots,"progress",{},void 0,!0)]),o("div",ie,[o("div",null,[m("剩餘: "),k(s.$slots,"remains",{},void 0,!0)]),o("div",null,[m("支出: "),k(s.$slots,"cost",{},void 0,!0)])])])])}}},pe=z(ge,[["__scopeId","data-v-36f82436"]]),ve=a=>(W("data-v-15589629"),a=a(),X(),a),_e={class:"budgetContainer m50"},me={class:"monthlyBudgetBox"},fe={class:"left"},he={class:"percentage-value"},Be={class:"right"},be={class:"notice"},ye=ve(()=>o("div",null,"各類別預算",-1)),Ie={class:"budgetCateContainer"},Ce={__name:"index",setup(a){const e=l(0),u=l(!1),r=l(!0),c=l(null),d=l(null),b=l([]),y=l([]),s=l(),M=l(),v=l(0),h=l(0),B=/^[1-9]\d*$/,O=()=>{r.value=!1,u.value=!0,c.value.focus()},D=async()=>{if(!B.test(e.value))return N.error("金額只能是正整數");b.value.length===0?await te({totalBudget:e.value,budgetYear:d.value.currentYear,budgetMonth:d.value.exposeMonth}):(e.value||(e.value=0),await ae({totalBudget:e.value,id:b.value[0].id})),r.value=!0,u.value=!1,V()},V=async()=>{s.value=d.value.currentYear.toString(),M.value=d.value.exposeMonth.toString();const{data:{data:x}}=await ee(d.value.currentYear,d.value.exposeMonth);x.length>0&&(b.value=x,e.value=b.value[0].totalBudget),console.log("本月預算1--"+e.value)},E=async()=>{const{data:x}=await oe(d.value.currentYear,d.value.exposeMonth);y.value=x.data,v.value=y.value.reduce((f,I)=>f+I.totalSum,0),h.value=y.value.reduce((f,I)=>f+I.budget,0)},L=()=>{E()},j=()=>{V(),E()};return J(()=>{V(),E()}),(x,f)=>{const I=g("el-progress"),F=g("el-input"),P=g("font-awesome-icon"),U=g("el-form-item"),q=g("el-form"),Y=g("el-descriptions-item"),G=g("el-descriptions"),H=g("el-card");return p(),T("div",_e,[i(Z,{ref_key:"month",ref:d,onChangeMonth:j},null,512),i(H,{shadow:"never"},{default:n(()=>[o("div",me,[o("div",fe,[i(I,{type:"circle",percentage:isNaN(parseInt((e.value-v.value)/e.value*100))||parseInt((e.value-v.value)/e.value*100)<0?0:parseInt((e.value-v.value)/e.value*100),color:"#2ED573","stroke-width":"12"},{default:n(({percentage:t})=>[o("span",he,_(t)+"%",1)]),_:1},8,["percentage"])]),o("div",Be,[i(q,null,{default:n(()=>[i(U,{label:"本月總預算"},{default:n(()=>[i(F,{ref_key:"inp",ref:c,modelValue:e.value,"onUpdate:modelValue":f[0]||(f[0]=t=>e.value=t),maxlength:"9",readonly:r.value,size:"large",style:{width:"200px","font-size":"20px"},formatter:t=>`$ ${t}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:t=>t.replace(/\$\s?|(,*)/g,"")},null,8,["modelValue","readonly","formatter","parser"]),u.value?(p(),w(P,{key:1,icon:["fas","circle-check"],onClick:f[1]||(f[1]=t=>D())})):(p(),w(P,{key:0,icon:["fas","pencil"],onClick:O}))]),_:1})]),_:1}),i(G,{column:"1"},{default:n(()=>[i(Y,{label:"本月總支出"},{default:n(()=>[m(_($(C)(v.value)),1)]),_:1}),i(Y,{label:"剩餘"},{default:n(()=>[m(_(isNaN(e.value-v.value)?0:$(C)(e.value-v.value)),1)]),_:1})]),_:1})])])]),_:1}),o("div",be,[ye,o("div",{class:K({danger:e.value-h.value<0})}," 待分配預算: "+_(e.value-h.value<0?"各類別預算總和已超過本月總預算!!":$(C)(e.value-h.value)),3)]),o("div",Ie,[(p(!0),T(Q,null,R(y.value,t=>(p(),w(pe,{key:t.id,cateItem:t,year:s.value,month:M.value,onSuccess:L},{icon:n(()=>[m(_(t.categoryPic),1)]),cateBudget:n(()=>[m(_(t.budget?$(C)(t.budget):"---"),1)]),cateName:n(()=>[m(_(t.categoryName),1)]),remains:n(()=>[m(_(t.budget?$(C)(t.budget-t.totalSum):"---"),1)]),cost:n(()=>[m(_(t.totalSum?$(C)(t.totalSum):0),1)]),progress:n(()=>[i(I,{"text-inside":!0,"stroke-width":20,percentage:isNaN(parseInt((t.budget-t.totalSum)/t.budget*100))||parseInt((t.budget-t.totalSum)/t.budget*100)<0?0:parseInt((t.budget-t.totalSum)/t.budget*100)},null,8,["percentage"])]),_:2},1032,["cateItem","year","month"]))),128))])])}}},Me=z(Ce,[["__scopeId","data-v-15589629"]]);export{Me as default};
